{% extends "base.html" %}

{% block head %}
<style>
    .map-container {
        position: relative;
        width: 100vw;
        height: 100vh;
        background: var(--bg);
        overflow: visible;
        padding-bottom: 100px;
    }
    
    .floorplan {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80vmin;
        height: 60vmin;
        border: 2px solid var(--primary);
        background: rgba(10, 10, 10, 0.9);
    }
    
    .project-hotspot {
        position: absolute;
        width: 40px;
        height: 40px;
        border: 2px solid var(--accent);
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
    }
    
    .project-hotspot:hover {
        transform: scale(1.2);
        background: var(--accent);
        color: var(--secondary);
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    }
    
    .project-preview {
        position: absolute;
        background: var(--secondary);
        border: 1px solid var(--primary);
        padding: 15px;
        max-width: 300px;
        box-shadow: 4px 4px 0 var(--primary);
        z-index: 100;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    
    .project-preview.show {
        opacity: 1;
        pointer-events: all;
    }
    
    .intro-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: var(--bg);
        color: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        opacity: 1;
        transition: opacity 1s ease;
    }
    
    .intro-overlay.hidden {
        opacity: 0;
        pointer-events: none;
        z-index: -1;
    }
    
    .intro-text {
        text-align: center;
        max-width: 600px;
        padding: 40px;
    }
    
    .intro-text h1 {
        font-size: 3rem;
        margin-bottom: 2rem;
        animation: glitch 3s infinite;
    }
    
    .intro-text p {
        font-size: 1.2rem;
        margin-bottom: 2rem;
        opacity: 0;
        animation: fadeIn 1s ease-in 1s forwards;
    }
    
    .intro-instructions {
        margin: 2rem 0;
        opacity: 0;
        animation: fadeIn 1s ease-in 1.5s forwards;
    }
    
    .instruction-text {
        font-size: 1rem;
        color: var(--accent);
        margin-bottom: 0.5rem !important;
        font-family: 'JetBrains Mono', monospace;
        letter-spacing: 1px;
    }
    
    .instruction-subtext {
        font-size: 0.9rem;
        color: var(--muted);
        font-style: italic;
        margin-bottom: 0 !important;
    }
    
    .enter-btn {
        background: none;
        border: 2px solid var(--accent);
        color: var(--accent);
        padding: 15px 30px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        opacity: 0;
        animation: fadeIn 1s ease-in 2s forwards;
    }
    
    .enter-btn:hover {
        background: var(--accent);
        color: var(--secondary);
        transform: translate(-2px, -2px);
        box-shadow: 2px 2px 0 var(--accent);
    }
    
    .floating-fragments {
        position: fixed;
        font-size: 12px;
        color: var(--muted);
        opacity: 0.6;
        animation: float 12s infinite linear;
        pointer-events: none;
        z-index: -1;
    }
    
    @keyframes float {
        0% { transform: translateY(100vh) rotate(0deg); }
        100% { transform: translateY(-100px) rotate(360deg); }
    }
    
    .guide-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1500;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease;
    }
    
    .guide-overlay.show {
        opacity: 1;
        pointer-events: all;
    }
    
    .guide-content {
        background: var(--secondary);
        padding: 3rem;
        border-radius: 8px;
        max-width: 500px;
        text-align: center;
        border: 2px solid var(--accent);
        color: var(--primary);
    }
    
    .guide-content h3 {
        color: var(--accent);
        margin-bottom: 2rem;
        font-size: 1.5rem;
    }
    
    .guide-steps {
        text-align: left;
        margin-bottom: 2rem;
    }
    
    .guide-step {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1rem;
        gap: 1rem;
    }
    
    .step-number {
        background: var(--accent);
        color: var(--secondary);
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
        flex-shrink: 0;
    }
    
    .guide-step p {
        margin: 0;
        font-size: 0.9rem;
        line-height: 1.4;
    }
    
    .guide-close {
        background: var(--accent);
        color: var(--secondary);
        border: none;
        padding: 12px 24px;
        font-size: 1rem;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.3s ease;
    }
    
    .guide-close:hover {
        transform: translate(-2px, -2px);
        box-shadow: 2px 2px 0 var(--secondary);
    }
    
    .space-label {
        position: absolute;
        top: 10px;
        left: 10px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 12px;
        color: var(--muted);
        opacity: 0.7;
    }
    
    .preview-hint {
        margin-top: 1rem;
        font-size: 0.8rem;
        color: var(--accent);
        font-family: 'JetBrains Mono', monospace;
        opacity: 0.8;
    }
    
    .entrance-symbol {
        position: absolute;
        width: 80px;
        height: 30px;
        border: 2px dashed var(--accent);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'JetBrains Mono', monospace;
        font-size: 12px;
        color: var(--accent);
        background: rgba(255, 255, 255, 0.1);
        letter-spacing: 1px;
    }

    .stage-element {
        position: absolute;
        left: 5%;
        top: 50%;
        transform: translateY(-50%);
        width: 15px;
        height: 100px;
        border: 1px solid var(--muted);
        background: rgba(255, 255, 255, 0.05);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .stage-label {
        font-family: 'JetBrains Mono', monospace;
        font-size: 10px;
        color: var(--muted);
        writing-mode: vertical-rl;
        text-orientation: mixed;
        letter-spacing: 1px;
    }

    .main-title {
        position: absolute;
        top: 12%;
        left: 50%;
        transform: translateX(-50%);
        font-family: 'Times New Roman', serif;
        font-size: 2.5rem;
        color: var(--primary);
        font-weight: normal;
        z-index: 5;
        margin: 0;
        text-align: center;
        letter-spacing: 2px;
    }

    .plan-subtitle {
        position: absolute;
        top: 20%;
        left: 50%;
        transform: translateX(-50%);
        font-family: 'Times New Roman', serif;
        font-size: 1rem;
        color: var(--muted);
        font-weight: normal;
        z-index: 5;
        margin: 0;
        text-align: center;
        letter-spacing: 1px;
        font-style: italic;
        opacity: 0.8;
    }

    .project-list {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: rgba(10, 10, 10, 0.9);
        padding: 15px 20px;
        border: 1px solid var(--primary);
        z-index: 10;
        max-width: 250px;
    }

    .project-list h3 {
        margin-top: 0;
        margin-bottom: 10px;
        font-family: 'JetBrains Mono', monospace;
        color: var(--primary);
        font-size: 1rem;
    }

    .project-list ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .project-list li a {
        display: block;
        padding: 4px 0;
        color: var(--primary);
        text-decoration: none;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.8rem;
        transition: color 0.3s ease;
    }

    .project-list li a:hover {
        color: var(--accent);
        text-decoration: underline;
    }

    .qr-container {
        position: absolute;
        bottom: 20px;
        right: 20px;
        background: rgba(10, 10, 10, 0.9);
        padding: 15px;
        border: 1px solid var(--primary);
        z-index: 10;
        text-align: center;
    }

    .qr-container img {
        width: 100px;
        height: 100px;
        display: block;
    }

    .qr-container p {
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.8rem;
        margin-top: 10px;
        margin-bottom: 0;
        color: var(--primary);
    }

    @media (max-width: 768px) {
        .main-title {
            position: relative;
            top: auto;
            left: auto;
            transform: none;
            text-align: center;
            margin-top: 8vh;
            margin-bottom: 0.5rem;
            font-size: 2rem;
        }
        
        .plan-subtitle {
            position: relative;
            top: auto;
            left: auto;
            transform: none;
            text-align: center;
            margin-top: 0.5rem;
            margin-bottom: 2rem;
            font-size: 1rem;
        }
        .map-container {
            height: auto;
            overflow: visible;
        }
        .floorplan {
            position: relative;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 2rem;
            margin-bottom: 5vh;
            width: 90vw;
            height: 70vw;
        }
        .project-list {
            position: relative;
            bottom: auto;
            left: auto;
            margin: 0 auto 20px auto;
            max-width: 90vw;
        }
        .entrance-symbol {
            /* Using !important to override inline styles on mobile */
            left: auto !important;
            right: 5% !important;
            top: 5% !important;
            width: 70px !important;
            height: 25px !important;
            font-size: 10px !important;
        }
        .qr-container {
            display: none;
        }
    }

    .intro-section {
        max-width: 800px;
        margin: 4rem auto;
        padding: 0 2rem;
        color: var(--primary);
        font-family: 'Helvetica Neue', sans-serif;
    }
    .intro-section p {
        line-height: 1.7;
        margin-bottom: 2em;
        font-size: 1.1rem;
        color: var(--muted);
    }
    .intro-section .lead-paragraph {
        font-size: 1.4rem;
        color: var(--primary);
        font-weight: 300;
        letter-spacing: 0.5px;
    }
    .pull-quote {
        font-size: 2rem;
        font-family: 'Times New Roman', serif;
        font-style: italic;
        color: var(--accent);
        text-align: center;
        margin: 3rem 0;
        padding: 1rem;
        border-top: 1px solid var(--muted);
        border-bottom: 1px solid var(--muted);
        line-height: 1.4;
        animation: fadeIn 2s ease;
    }
    .highlight-text {
        color: var(--accent);
        font-family: 'JetBrains Mono', monospace;
        background: rgba(255, 255, 255, 0.05);
        padding: 2px 5px;
    }
    .intro-section h2 {
        font-family: 'Times New Roman', serif;
        font-size: 2rem;
        color: var(--primary);
        text-align: left;
        margin-bottom: 0.5rem;
        font-weight: normal;
    }
    .read-more-link {
        display: block;
        text-align: left;
        margin-bottom: 2rem;
        color: var(--accent);
        text-decoration: none;
        font-family: 'JetBrains Mono', monospace;
    }
    .read-more-link:hover {
        text-decoration: underline;
    }
    .intro-section h3 {
        font-family: 'JetBrains Mono', monospace;
        font-size: 1.5rem;
        color: var(--primary);
        margin-top: 4rem;
        margin-bottom: 1rem;
        text-align: center;
        letter-spacing: 2px;
        text-transform: uppercase;
    }

    .credits-section {
        margin-top: 5rem;
        padding-top: 2rem;
        border-top: 1px solid var(--muted);
        text-align: center;
    }
    .credits-section p {
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.9rem;
        color: var(--muted);
        line-height: 1.8;
        margin-bottom: 0.5rem;
    }
    .credits-section .role {
        color: var(--primary);
        font-weight: bold;
    }

    .logo-section {
        margin-top: 4rem;
        padding-top: 2rem;
        border-top: 1px solid var(--muted);
        text-align: center;
    }
    .logo-section h4 {
        font-family: 'JetBrains Mono', monospace;
        font-size: 1rem;
        color: var(--muted);
        margin-bottom: 2rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .logo-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 4rem;
        flex-wrap: wrap;
    }
    .logo-container img {
        max-height: 60px;
        max-width: 150px;
        filter: grayscale(100%) brightness(1.5);
        transition: filter 0.3s ease;
    }
    .logo-container img:hover {
        filter: none;
    }
    .logo-container img[src*="milieux.png"],
    .logo-container img[src*="concordia.png"],
    .logo-container img[src*="HEXAGRAM.png"],
    .logo-container img[src*="mutek.png"] {
        filter: invert(1) grayscale(100%) brightness(1.5);
    }
    .logo-container img[src*="milieux.png"]:hover,
    .logo-container img[src*="concordia.png"]:hover,
    .logo-container img[src*="HEXAGRAM.png"]:hover,
    .logo-container img[src*="mutek.png"]:hover {
        filter: invert(1) grayscale(0%);
    }
    .logo-container img[src*="AppliedAI.png"] {
        filter: invert(1) grayscale(1);
    }
    
    .exhibition-feedback {
        background: rgba(0, 255, 136, 0.05);
        border: 1px solid rgba(0, 255, 136, 0.2);
        padding: 2rem;
        margin: 2rem 0;
        text-align: center;
    }
    
    .exhibition-feedback h3 {
        color: var(--accent);
        margin-bottom: 1rem;
        font-size: 1.2rem;
    }
    
    .exhibition-feedback p {
        color: var(--muted);
        margin-bottom: 1.5rem;
        font-size: 0.9rem;
    }
    
    .exhibition-feedback form {
        max-width: 600px;
        margin: 0 auto;
    }
    
    .exhibition-feedback textarea {
        width: 100%;
        min-height: 120px;
        padding: 1rem;
        border: 1px solid rgba(0, 255, 136, 0.3);
        background: rgba(0, 0, 0, 0.1);
        color: var(--primary);
        font-family: inherit;
        font-size: 0.9rem;
        resize: vertical;
        margin-bottom: 1rem;
    }
    
    .exhibition-feedback textarea:focus {
        outline: none;
        border-color: var(--accent);
        background: rgba(0, 255, 136, 0.1);
    }
    
    .exhibition-feedback button {
        background: var(--secondary);
        border: 2px solid var(--accent);
        color: var(--accent);
        padding: 12px 24px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'JetBrains Mono', monospace;
        letter-spacing: 1px;
        text-transform: uppercase;
    }
    
    .exhibition-feedback button:hover {
        background: var(--accent);
        color: var(--secondary);
        transform: translate(-2px, -2px);
        box-shadow: 2px 2px 0 var(--accent);
    }
    
    .exhibition-feedback button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }
    
    #exhibitionFeedbackStatus {
        margin-top: 1rem;
        padding: 0.5rem;
        font-size: 0.9rem;
        font-family: 'JetBrains Mono', monospace;
    }
    
    #exhibitionFeedbackStatus.success {
        color: var(--accent);
        background: rgba(0, 255, 136, 0.1);
        border: 1px solid rgba(0, 255, 136, 0.3);
    }
    
    #exhibitionFeedbackStatus.error {
        color: #ff6b6b;
        background: rgba(255, 107, 107, 0.1);
        border: 1px solid rgba(255, 107, 107, 0.3);
    }
    
    @media (max-width: 768px) {
        .exhibition-feedback {
            padding: 1.5rem 1rem;
            margin: 1.5rem 0;
        }
        
        .exhibition-feedback h3 {
            font-size: 1.1rem;
        }
        
        .exhibition-feedback textarea {
            min-height: 100px;
            padding: 0.8rem;
            font-size: 0.85rem;
        }
        
        .exhibition-feedback button {
            padding: 10px 20px;
            font-size: 0.8rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="intro-overlay" id="introOverlay">
    <div class="intro-text">
        <h1 class="glitch">MACHINIC ENCOUNTERS <br> web-catalog</h1>
        <p>An exhibition exploring the thresholds of human-machine encounters</p>
        <div class="intro-instructions">
            <p class="instruction-text">Navigate the space • Discover projects • Share your thoughts</p>
            <p class="instruction-subtext">Leave a trace of your encounters</p>
        </div>
        <button class="enter-btn" onclick="enterExhibition()">ENTER</button>
    </div>
</div>

<div class="map-container">
    <div class="guide-overlay" id="guideOverlay">
        <div class="guide-content">
            <h3>How to Navigate</h3>
            <div class="guide-steps">
                <div class="guide-step">
                    <span class="step-number">1</span>
                    <p>Hover over/tap on numbered circles to preview projects</p>
                </div>
                <div class="guide-step">
                    <span class="step-number">2</span>
                    <p>Click/tap to visit a project and leave your thoughts</p>
                </div>
                <div class="guide-step">
                    <span class="step-number">3</span>
                    <p>Check the Dashboard to see collective reflections</p>
                </div>
                <div class="guide-step">
                    <span class="step-number">4</span>
                    <p>Visit Trace to see your personal journey</p>
                </div>
            </div>
            <button class="guide-close" onclick="closeGuide()">Begin Exploration</button>
        </div>
    </div>
    
    <h1 class="main-title">Machinic Encounters</h1>
    <h2 class="plan-subtitle">Exhibition Plan</h2>
    <div class="floorplan" id="floorplan">
        <div class="space-label">Studio Hydro-Québec</div>
        <div class="entrance-symbol" style="left: 85%; top: 5%;">ENTRANCE</div>
        <div class="stage-element">
            <span class="stage-label">STAGE</span>
        </div>
        {% for project_id, project in projects.items() %}
        <div class="project-hotspot" 
             style="left: {{ project.position.x }}%; top: {{ project.position.y }}%;"
             data-project="{{ project_id }}"
             onmouseenter="showPreview(event, '{{ project_id }}')"
             onmouseleave="hidePreview()"
             onclick="visitProject('{{ project_id }}')">
            {{ loop.index }}
        </div>
        {% endfor %}
    </div>
    
    <div class="project-preview" id="projectPreview">
        <img id="previewThumb" src="" alt="" style="width: 100%; height: 120px; object-fit: cover; margin-bottom: 10px; border: 1px solid var(--primary);">
        <h3 id="previewTitle"></h3>
        <p class="mono muted" id="previewArtist"></p>
        <p id="previewDesc"></p>
        <p class="mono accent" id="previewVibe"></p>
        <div class="preview-hint">Click to explore →</div>
    </div>

    <div class="project-list">
        <h3>Projects</h3>
        <ul>
            {% for project_id, project in projects.items() %}
            <li><a href="/project/{{ project_id }}">{{ loop.index }}. {{ project.title }}</a></li>
            {% endfor %}
        </ul>
    </div>

    <div class="qr-container">
        <img src="{{ url_for('static', filename='img/qr_code.png') }}" alt="QR Code">
        <p>Leave your trace</p>
    </div>
</div>

<div class="intro-section">
    <h2>Curator Statement</h2>
    <a href="/curator-statement" class="read-more-link">read the full introduction →</a>
    <p class="lead-paragraph">Today, we live amidst the ubiquitous abundance of technology. Our machines orient our perception of reality, rendering possible certain activities while occluding others, all the while unproblematically accompanying us in the flow of reality.</p>
    <p>This is where all us cyborgs live, as we adapt unconsciously to the functioning of the <span class="highlight-text">search algorithms</span>, <span class="highlight-text">recommendation systems</span>, <span class="highlight-text">affective computing</span>, and <span class="highlight-text">social media analytics</span>. However rigid the exterior may be, and no matter what complex relationalities they harbor, machines in our current paradigm are often designed to disappear. They ought to become so intuitive, functional, and seamlessly integrated into use that we should no longer notice the very technology itself.</p>
    <p>And so, it seems we are not able to ‘encounter’ the machines, even if we tried. Their <span class="highlight-text">black box</span> exterior obscures the complex movements of capital, matter, data, bodies, and desires. In a time when dominant understandings of technology are handed down in fetishes by elite interests to serve their own ends, it is ever more urgent to invent our own ways of thinking, sensing, and relating to machines.</p>
    
    <blockquote class="pull-quote">
        This exhibition arises from that very impulse: to encounter machines in their strangeness, in their manifold agencies, and shifting manifestations.
    </blockquote>
    
    <p>The 8 research-creation works gathered here explore the machinic in its multiple registers: as assemblages of interlocking mechanisms; as mythic sites of projection and possibility; and as aesthetic systems for composing new forms of connection.</p>
    <p>Each piece invites us to linger in the encounter: we are not to solve and figure out the machines, but to sense their pulsing rhythm through <span class="highlight-text">play, curiosity, and wonder</span>.</p>
    
    <h3>Play and Process</h3>
    <p>The Machinic Encounters residency group have developed their projects over the summer of 2025. The group stayed in conversation with one another through phases of exploration, development, and production. The pieces were developed in tandem with collective reflections, in an iteratively processual manner, which is the hallmark of research-creation approaches. This allowed the projects to not only change in dialogue with one another, but also flourish in unexpected ways. As artist-researchers have grappled with the affordances and limitations of machine learning technologies, their works became heuristics for exploring the contemporary cultural moment.</p>

    <p>The works in this residency program explore machinic agents in their multiplicity. We encounter machines as companions that never arrive; as instruments of governance and oppression; as agents that disclose new forms of aesthetics; as mediums for thought and divination; and as play interlocutors. The variety of perspectives that the artist-researchers brought in reveals the unsettled nature of machines, and how their meanings shift as we playfully explore different potentials with them. Grown weary of the contemporary moment in which our machines -as well as us- are entangled in the structures of power that work to advance inequalities and injustices, we find solace in the fact that we are yet to find tools for our mutual emancipation.</p>
    
    <blockquote class="pull-quote">
        Living in a society that is robbed of their capacity to imagine, we seek to ignite some wonder and awe against the face of an increasingly constricting technological order.
    </blockquote>
    
    <div class="exhibition-feedback">
        <h3>Share Your Thoughts on the Exhibition</h3>
        <p>Your reflections help us understand how these works resonate with visitors.</p>
        <form id="exhibitionFeedbackForm">
            <textarea id="exhibitionComment" placeholder="What did this exhibition make you think about? How did it make you feel?" maxlength="2000" required></textarea>
            <button type="submit">Share Reflection</button>
        </form>
        <div id="exhibitionFeedbackStatus"></div>
    </div>
    
    <div class="credits-section">
        <p><span class="role">Exhibition Curation :</span> Ceyda Yolg&ouml;rmez</p>
        <p><span class="role">Technical Direction:</span> Fran&ccedil;ois Lespinasse &amp; Kamyar Karimi</p>
        <p><span class="role">Website :</span> Fran&ccedil;ois Lespinasse</p>
    </div>

    <div class="logo-section">
        <h4>With support from</h4>
        <div class="logo-container">
            <img src="/static/img/concordia.png" alt="Concordia University Logo">
            <img src="/static/img/milieux.png" alt="Milieux Institute Logo">
            <img src="/static/img/AppliedAI.png" alt="Applied AI Institute Logo">
            <img src="/static/img/HEXAGRAM.png" alt="Hexagram Logo">
            <img src="/static/img/mutek.png" alt="MUTEK Logo">
        </div>
    </div>
</div>

<!-- Floating text fragments will be generated by script -->
{% endblock %}

{% block scripts %}
<script>
    const projects = {{ projects | tojson }};
    
    function enterExhibition() {
        document.getElementById('introOverlay').classList.add('hidden');
        // Mark as seen
        localStorage.setItem('machinic_encounters_seen', 'true');
        // Show guide after intro
        setTimeout(() => {
            document.getElementById('guideOverlay').classList.add('show');
        }, 500);
        // Start floating fragments
        createFloatingFragments();
    }
    
    
    function closeGuide() {
        document.getElementById('guideOverlay').classList.remove('show');
    }
    
    function createFloatingFragments() {
        const introText = document.querySelector('.intro-section').textContent;
        const words = introText.split(/\s+/);
        
        // Filter for meaningful words
        const commonWords = new Set(['a', 'an', 'the', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'is', 'are', 'was', 'were', 'it', 'that', 'this', 'as', 'we', 'our', 'be', 'to', 'not', 'its', 'from', 'by', 'with', 'they', 'their', 'even', 'if', 'so', 'what', 'when', 'where', 'why', 'how', 'all', 'any', 'some', 'each', 'no', 'nor', 'too', 'very', 'can', 'will', 'just']);
        const fragments = words.map(word => word.toLowerCase().replace(/[^a-z]/g, ''))
                               .filter(word => word.length > 4 && !commonWords.has(word));
        
        const uniqueFragments = [...new Set(fragments)];

        if (uniqueFragments.length === 0) return;

        setInterval(() => {
            if (Math.random() < 0.3) {
                const fragment = document.createElement('div');
                fragment.className = 'floating-fragments';
                fragment.textContent = uniqueFragments[Math.floor(Math.random() * uniqueFragments.length)];
                fragment.style.left = Math.random() * 100 + '%';
                fragment.style.animationDuration = (10 + Math.random() * 5) + 's';
                document.body.appendChild(fragment);
                
                setTimeout(() => {
                    fragment.remove();
                }, 15000);
            }
        }, 3000);
    }
    
    function showPreview(event, projectId) {
        const project = projects[projectId];
        const preview = document.getElementById('projectPreview');
        
        document.getElementById('previewThumb').src = `/static/img/${project.thumb}`;
        document.getElementById('previewThumb').alt = project.title;
        document.getElementById('previewTitle').textContent = project.title;
        document.getElementById('previewArtist').textContent = project.artist;
        document.getElementById('previewDesc').textContent = project.short_desc;
        document.getElementById('previewVibe').textContent = project.vibe;
        
        preview.style.left = event.pageX + 20 + 'px';
        preview.style.top = event.pageY - 50 + 'px';
        preview.classList.add('show');
    }
    
    function hidePreview() {
        document.getElementById('projectPreview').classList.remove('show');
    }
    
    function visitProject(projectId) {
        // Track the visit via API
        fetch('/visit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                project: projectId,
                visitor_id: visitorId
            })
        }).catch(err => console.log('Visit tracking failed:', err));
        
        window.location.href = `/project/${projectId}`;
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        // Check if user has seen intro before
        if (localStorage.getItem('machinic_encounters_seen') === 'true') {
            document.getElementById('introOverlay').classList.add('hidden');
            createFloatingFragments();
        }

        // Exhibition feedback form
        const exhibitionForm = document.getElementById('exhibitionFeedbackForm');
        if (exhibitionForm) {
            exhibitionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const comment = document.getElementById('exhibitionComment').value.trim();
                const statusDiv = document.getElementById('exhibitionFeedbackStatus');
                const submitButton = exhibitionForm.querySelector('button[type="submit"]');
                
                if (!comment) {
                    statusDiv.textContent = 'Please enter your thoughts before submitting.';
                    statusDiv.className = 'error';
                    return;
                }
                
                // Disable button and show loading
                submitButton.disabled = true;
                submitButton.textContent = 'Sharing...';
                statusDiv.textContent = '';
                statusDiv.className = '';
                
                // Submit feedback
                fetch('/feedback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        project: 'exhibition_general',
                        content: comment,
                        visitor_id: visitorId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'ok') {
                        statusDiv.textContent = 'Thank you for sharing your reflection!';
                        statusDiv.className = 'success';
                        document.getElementById('exhibitionComment').value = '';
                    } else {
                        throw new Error(data.error || 'Failed to submit feedback');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    statusDiv.textContent = 'Error submitting feedback. Please try again.';
                    statusDiv.className = 'error';
                })
                .finally(() => {
                    submitButton.disabled = false;
                    submitButton.textContent = 'Share Reflection';
                });
            });
        }
    });

</script>
{% endblock %}
