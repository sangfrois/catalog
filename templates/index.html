{% extends "base.html" %}

{% block head %}
<style>
    .map-container {
        position: relative;
        width: 100vw;
        height: 100vh;
        background: var(--bg);
        overflow: hidden;
    }
    
    .floorplan {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80vmin;
        height: 60vmin;
        border: 2px solid var(--primary);
        background: rgba(10, 10, 10, 0.9);
    }
    
    .project-hotspot {
        position: absolute;
        width: 40px;
        height: 40px;
        border: 2px solid var(--accent);
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
    }
    
    .project-hotspot:hover {
        transform: scale(1.2);
        background: var(--accent);
        color: var(--secondary);
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    }
    
    .project-preview {
        position: absolute;
        background: var(--secondary);
        border: 1px solid var(--primary);
        padding: 15px;
        max-width: 300px;
        box-shadow: 4px 4px 0 var(--primary);
        z-index: 100;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    
    .project-preview.show {
        opacity: 1;
        pointer-events: all;
    }
    
    .intro-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: var(--bg);
        color: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        opacity: 1;
        transition: opacity 1s ease;
    }
    
    .intro-overlay.hidden {
        opacity: 0;
        pointer-events: none;
    }
    
    .intro-text {
        text-align: center;
        max-width: 600px;
        padding: 40px;
    }
    
    .intro-text h1 {
        font-size: 3rem;
        margin-bottom: 2rem;
        animation: glitch 3s infinite;
    }
    
    .intro-text p {
        font-size: 1.2rem;
        margin-bottom: 2rem;
        opacity: 0;
        animation: fadeIn 1s ease-in 1s forwards;
    }
    
    .intro-instructions {
        margin: 2rem 0;
        opacity: 0;
        animation: fadeIn 1s ease-in 1.5s forwards;
    }
    
    .instruction-text {
        font-size: 1rem;
        color: var(--accent);
        margin-bottom: 0.5rem !important;
        font-family: 'JetBrains Mono', monospace;
        letter-spacing: 1px;
    }
    
    .instruction-subtext {
        font-size: 0.9rem;
        color: var(--muted);
        font-style: italic;
        margin-bottom: 0 !important;
    }
    
    .enter-btn {
        background: none;
        border: 2px solid var(--accent);
        color: var(--accent);
        padding: 15px 30px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        opacity: 0;
        animation: fadeIn 1s ease-in 2s forwards;
    }
    
    .enter-btn:hover {
        background: var(--accent);
        color: var(--secondary);
        transform: translate(-2px, -2px);
        box-shadow: 2px 2px 0 var(--accent);
    }
    
    .floating-fragments {
        position: absolute;
        font-size: 12px;
        color: var(--muted);
        opacity: 0.3;
        animation: float 10s infinite linear;
        pointer-events: none;
    }
    
    @keyframes float {
        0% { transform: translateY(100vh) rotate(0deg); }
        100% { transform: translateY(-100px) rotate(360deg); }
    }
    
    .guide-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1500;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease;
    }
    
    .guide-overlay.show {
        opacity: 1;
        pointer-events: all;
    }
    
    .guide-content {
        background: var(--secondary);
        padding: 3rem;
        border-radius: 8px;
        max-width: 500px;
        text-align: center;
        border: 2px solid var(--accent);
        color: var(--primary);
    }
    
    .guide-content h3 {
        color: var(--accent);
        margin-bottom: 2rem;
        font-size: 1.5rem;
    }
    
    .guide-steps {
        text-align: left;
        margin-bottom: 2rem;
    }
    
    .guide-step {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1rem;
        gap: 1rem;
    }
    
    .step-number {
        background: var(--accent);
        color: var(--secondary);
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
        flex-shrink: 0;
    }
    
    .guide-step p {
        margin: 0;
        font-size: 0.9rem;
        line-height: 1.4;
    }
    
    .guide-close {
        background: var(--accent);
        color: var(--secondary);
        border: none;
        padding: 12px 24px;
        font-size: 1rem;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.3s ease;
    }
    
    .guide-close:hover {
        transform: translate(-2px, -2px);
        box-shadow: 2px 2px 0 var(--secondary);
    }
    
    .space-label {
        position: absolute;
        top: 10px;
        left: 10px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 12px;
        color: var(--muted);
        opacity: 0.7;
    }
    
    .preview-hint {
        margin-top: 1rem;
        font-size: 0.8rem;
        color: var(--accent);
        font-family: 'JetBrains Mono', monospace;
        opacity: 0.8;
    }
    
    .entrance-symbol {
        position: absolute;
        width: 80px;
        height: 30px;
        border: 2px dashed var(--accent);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'JetBrains Mono', monospace;
        font-size: 12px;
        color: var(--accent);
        background: rgba(255, 255, 255, 0.1);
        letter-spacing: 1px;
    }

    .project-list {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: rgba(10, 10, 10, 0.9);
        padding: 15px 20px;
        border: 1px solid var(--primary);
        z-index: 10;
        max-width: 250px;
    }

    .project-list h3 {
        margin-top: 0;
        margin-bottom: 10px;
        font-family: 'JetBrains Mono', monospace;
        color: var(--primary);
        font-size: 1rem;
    }

    .project-list ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .project-list li a {
        display: block;
        padding: 4px 0;
        color: var(--primary);
        text-decoration: none;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.8rem;
        transition: color 0.3s ease;
    }

    .project-list li a:hover {
        color: var(--accent);
        text-decoration: underline;
    }

    @media (max-width: 768px) {
        .map-container {
            height: auto;
            overflow: visible;
        }
        .floorplan {
            position: relative;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 12vh;
            margin-bottom: 5vh;
            width: 90vw;
            height: 70vw;
        }
        .project-list {
            position: relative;
            bottom: auto;
            left: auto;
            margin: 0 auto 20px auto;
            max-width: 90vw;
        }
        .entrance-symbol {
            /* Using !important to override inline styles on mobile */
            left: auto !important;
            right: 5% !important;
            top: 5% !important;
            width: 70px !important;
            height: 25px !important;
            font-size: 10px !important;
        }
    }

    .intro-section {
        max-width: 800px;
        margin: 4rem auto;
        padding: 0 2rem;
        color: var(--primary);
        font-family: 'Helvetica Neue', sans-serif;
    }
    .intro-section p {
        line-height: 1.7;
        margin-bottom: 2em;
        font-size: 1.1rem;
        color: var(--muted);
    }
    .intro-section .lead-paragraph {
        font-size: 1.4rem;
        color: var(--primary);
        font-weight: 300;
        letter-spacing: 0.5px;
    }
    .pull-quote {
        font-size: 2rem;
        font-family: 'Times New Roman', serif;
        font-style: italic;
        color: var(--accent);
        text-align: center;
        margin: 3rem 0;
        padding: 1rem;
        border-top: 1px solid var(--muted);
        border-bottom: 1px solid var(--muted);
        line-height: 1.4;
        animation: fadeIn 2s ease;
    }
    .highlight-text {
        color: var(--accent);
        font-family: 'JetBrains Mono', monospace;
        background: rgba(255, 255, 255, 0.05);
        padding: 2px 5px;
    }
    .intro-section h2 {
        font-family: 'Times New Roman', serif;
        font-size: 2.5rem;
        color: var(--primary);
        text-align: center;
        margin-bottom: 2rem;
        font-weight: normal;
    }
    .intro-section h3 {
        font-family: 'JetBrains Mono', monospace;
        font-size: 1.5rem;
        color: var(--primary);
        margin-top: 4rem;
        margin-bottom: 1rem;
        text-align: center;
        letter-spacing: 2px;
        text-transform: uppercase;
    }
</style>
{% endblock %}

{% block content %}
<div class="intro-overlay" id="introOverlay">
    <div class="intro-text">
        <h1 class="glitch">MACHINIC<br>ENCOUNTERS</h1>
        <p>An exhibition exploring the thresholds of human-machine encounters</p>
        <div class="intro-instructions">
            <p class="instruction-text">Navigate the space • Discover projects • Share your thoughts</p>
            <p class="instruction-subtext">Your reflections become part of the collective mind</p>
        </div>
        <button class="enter-btn" onclick="enterExhibition()">ENTER</button>
    </div>
</div>

<div class="map-container">
    <div class="guide-overlay" id="guideOverlay">
        <div class="guide-content">
            <h3>How to Navigate</h3>
            <div class="guide-steps">
                <div class="guide-step">
                    <span class="step-number">1</span>
                    <p>Hover over numbered circles to preview projects</p>
                </div>
                <div class="guide-step">
                    <span class="step-number">2</span>
                    <p>Click to visit a project and leave your thoughts</p>
                </div>
                <div class="guide-step">
                    <span class="step-number">3</span>
                    <p>Check the Dashboard to see collective reflections</p>
                </div>
                <div class="guide-step">
                    <span class="step-number">4</span>
                    <p>Visit Trace to see your personal journey</p>
                </div>
            </div>
            <button class="guide-close" onclick="closeGuide()">Begin Exploration</button>
        </div>
    </div>
    
    <div class="floorplan" id="floorplan">
        <div class="space-label">Studio Hydro-Québec</div>
        <div class="entrance-symbol" style="left: 85%; top: 5%;">ENTRANCE</div>
        {% for project_id, project in projects.items() %}
        <div class="project-hotspot" 
             style="left: {{ project.position.x }}%; top: {{ project.position.y }}%;"
             data-project="{{ project_id }}"
             onmouseenter="showPreview(event, '{{ project_id }}')"
             onmouseleave="hidePreview()"
             onclick="visitProject('{{ project_id }}')">
            {{ loop.index }}
        </div>
        {% endfor %}
    </div>
    
    <div class="project-preview" id="projectPreview">
        <img id="previewThumb" src="" alt="" style="width: 100%; height: 120px; object-fit: cover; margin-bottom: 10px; border: 1px solid var(--primary);">
        <h3 id="previewTitle"></h3>
        <p class="mono muted" id="previewArtist"></p>
        <p id="previewDesc"></p>
        <p class="mono accent" id="previewVibe"></p>
        <div class="preview-hint">Click to explore →</div>
    </div>

    <div class="project-list">
        <h3>Projects</h3>
        <ul>
            {% for project_id, project in projects.items() %}
            <li><a href="/project/{{ project_id }}">{{ loop.index }}. {{ project.title }}</a></li>
            {% endfor %}
        </ul>
    </div>
</div>

<div class="intro-section">
    <h2>On Machinic Encounters</h2>
    <p class="lead-paragraph">Today, we live amidst the ubiquitous abundance of technology. Our machines orient our perception of reality, rendering possible certain activities while occluding others. As long as technology doesn’t break, daily flow continues without interruption. We adapt unconsciously to the functioning of <span class="highlight-text">search algorithms</span>, <span class="highlight-text">recommendation systems</span>, and <span class="highlight-text">social media analytics</span>. These systems open up new possibilities, even as they constrain and enframe our being-in-the-world.</p>
    
    <p>And yet, we are not able to truly ‘encounter’ the machines. Their <span class="highlight-text">black box</span> exterior obscures the complex movements of capital, matter, and data. Designed to disappear, they become so intuitive and seamlessly integrated that we no longer notice the technology itself.</p>
    
    <p>Here, art becomes instructive, able to reveal the interiority of the machines without compromising their ‘magic’. Artistic practice reanimates the machinic with the unexpected, the mysterious, and the sublime. It opens space for us to discover new meanings, trace invisible mechanisms, and craft <span class="highlight-text">counter-narratives</span>.</p>

    <blockquote class="pull-quote">
        This exhibition arises from that very impulse: to encounter machines in their strangeness, in their manifold agencies, and shifting manifestations.
    </blockquote>

    <p>The 8 research-creation works gathered here explore the machinic in its multiple registers: as assemblages of interlocking mechanisms; as mythic sites of projection and possibility; and as aesthetic systems for composing new forms of connection. Each piece invites us to linger in the encounter: not to solve and figure out the machines, but to sense their pulsing rhythm through <span class="highlight-text">play, curiosity, and wonder</span>.</p>
    
    <h3>Play and Process</h3>
    <p>The Machinic Encounters residency group have developed their projects over the summer of 2025. The pieces were developed in collective reflection, in an iteratively processual manner, which is the hallmark of research-creation approaches. As artist-researchers have grappled with the affordances and limitations of contemporary machine learning technologies, their works became heuristics for exploring dimensions of human-machine relationality that cannot be reduced to...</p>
</div>

<!-- Floating text fragments will be generated by script -->
{% endblock %}

{% block scripts %}
<script>
    const projects = {{ projects | tojson }};
    
    function enterExhibition() {
        document.getElementById('introOverlay').classList.add('hidden');
        // Mark as seen
        localStorage.setItem('machinc_encounters_seen', 'true');
        // Show guide after intro
        setTimeout(() => {
            document.getElementById('guideOverlay').classList.add('show');
        }, 500);
        // Start floating fragments
        createFloatingFragments();
    }
    
    // Check if user has seen intro before
    window.addEventListener('DOMContentLoaded', function() {
        if (localStorage.getItem('machinc_encounters_seen') === 'true') {
            document.getElementById('introOverlay').classList.add('hidden');
            createFloatingFragments();
        }
    });
    
    function closeGuide() {
        document.getElementById('guideOverlay').classList.remove('show');
    }
    
    function createFloatingFragments() {
        const introText = document.querySelector('.intro-section').textContent;
        const words = introText.split(/\s+/);
        
        // Filter for meaningful words
        const commonWords = new Set(['a', 'an', 'the', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'is', 'are', 'was', 'were', 'it', 'that', 'this', 'as', 'we', 'our', 'be', 'to', 'not', 'its', 'from', 'by', 'with', 'they', 'their', 'even', 'if', 'so', 'what', 'when', 'where', 'why', 'how', 'all', 'any', 'some', 'each', 'no', 'nor', 'too', 'very', 'can', 'will', 'just']);
        const fragments = words.map(word => word.toLowerCase().replace(/[^a-z]/g, ''))
                               .filter(word => word.length > 4 && !commonWords.has(word));
        
        const uniqueFragments = [...new Set(fragments)];

        if (uniqueFragments.length === 0) return;

        setInterval(() => {
            if (Math.random() < 0.3) {
                const fragment = document.createElement('div');
                fragment.className = 'floating-fragments';
                fragment.textContent = uniqueFragments[Math.floor(Math.random() * uniqueFragments.length)];
                fragment.style.left = Math.random() * 100 + '%';
                fragment.style.animationDuration = (8 + Math.random() * 4) + 's';
                document.body.appendChild(fragment);
                
                setTimeout(() => {
                    fragment.remove();
                }, 12000);
            }
        }, 3000);
    }
    
    function showPreview(event, projectId) {
        const project = projects[projectId];
        const preview = document.getElementById('projectPreview');
        
        document.getElementById('previewThumb').src = `/img/${project.thumb}`;
        document.getElementById('previewThumb').alt = project.title;
        document.getElementById('previewTitle').textContent = project.title;
        document.getElementById('previewArtist').textContent = project.artist;
        document.getElementById('previewDesc').textContent = project.desc.substring(0, 150) + '...';
        document.getElementById('previewVibe').textContent = project.vibe;
        
        preview.style.left = event.pageX + 20 + 'px';
        preview.style.top = event.pageY - 50 + 'px';
        preview.classList.add('show');
    }
    
    function hidePreview() {
        document.getElementById('projectPreview').classList.remove('show');
    }
    
    function visitProject(projectId) {
        trackVisit(projectId);
        window.location.href = `/project/${projectId}`;
    }
</script>
{% endblock %}
