{% extends "base.html" %}

{% block head %}
<style>
    .project-container {
        min-height: 100vh;
        padding: 80px 20px 40px;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .project-header {
        text-align: center;
        margin-bottom: 3rem;
        border-bottom: 1px solid var(--muted);
        padding-bottom: 2rem;
    }
    
    .project-title {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        animation: glitch 4s infinite;
    }
    
    .project-artist {
        font-size: 1.2rem;
        color: var(--muted);
        margin-bottom: 1rem;
    }
    
    .project-vibe {
        color: var(--accent);
        font-size: 0.9rem;
        letter-spacing: 2px;
        text-transform: uppercase;
    }
    
    .project-content {
        margin-bottom: 3rem;
    }
    
    .project-desc {
        font-size: 1.1rem;
        line-height: 1.8;
        margin-bottom: 2rem;
    }
    
    .project-thumb {
        width: 100%;
        height: 300px;
        background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
        border: 1px solid var(--muted);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--muted);
        font-style: italic;
        margin-bottom: 2rem;
    }
    
    .feedback-section {
        border-top: 1px solid var(--muted);
        padding-top: 2rem;
    }
    
    .feedback-form {
        margin-bottom: 2rem;
    }
    
    .feedback-input {
        width: 100%;
        min-height: 100px;
        padding: 15px;
        border: 1px solid var(--muted);
        background: var(--secondary);
        font-family: 'Crimson Text', serif;
        font-size: 1rem;
        resize: vertical;
    }
    
    .feedback-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 2px rgba(0, 255, 136, 0.2);
    }
    
    .submit-btn {
        background: none;
        border: 2px solid var(--primary);
        color: var(--primary);
        padding: 12px 24px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 1rem;
    }
    
    .submit-btn:hover {
        background: var(--accent);
        border-color: var(--accent);
        transform: translate(-2px, -2px);
        box-shadow: 2px 2px 0 var(--primary);
    }
    
    .submit-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .feedback-success {
        color: var(--accent);
        margin-top: 1rem;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .feedback-success.show {
        opacity: 1;
    }
    
    .back-link {
        display: inline-block;
        margin-top: 2rem;
        color: var(--primary);
        text-decoration: none;
        border-bottom: 1px solid var(--primary);
        transition: all 0.3s ease;
    }
    
    .back-link:hover {
        color: var(--accent);
        border-color: var(--accent);
    }
</style>
{% endblock %}

{% block content %}
<div class="project-container fade-in">
    <div class="project-header">
        <h1 class="project-title">{{ project.title }}</h1>
        <p class="project-artist mono">{{ project.artist }}</p>
        <p class="project-vibe mono">{{ project.vibe }}</p>
    </div>
    
    <div class="project-content">
        <div class="project-thumb">
            [Project Thumbnail]
        </div>
        
        <p class="project-desc">{{ project.desc }}</p>
    </div>
    
    <div class="feedback-section">
        <h3>Leave a thought</h3>
        <p class="muted">What does this work make you feel? What questions does it raise?</p>
        
        <form class="feedback-form" onsubmit="submitThought(event)">
            <textarea 
                class="feedback-input" 
                placeholder="Your thoughts drift here..."
                id="thoughtInput"
                maxlength="500"></textarea>
            <button type="submit" class="submit-btn" id="submitBtn">Submit Thought</button>
            <p class="feedback-success mono" id="successMessage">Thought captured ✓</p>
        </form>
    </div>
    
    <a href="/" class="back-link">← Return to map</a>
</div>
{% endblock %}

{% block scripts %}
<script>
    const projectId = '{{ project_id }}';
    
    // Track visit on page load
    trackVisit(projectId);
    
    function submitThought(event) {
        event.preventDefault();
        
        const input = document.getElementById('thoughtInput');
        const btn = document.getElementById('submitBtn');
        const success = document.getElementById('successMessage');
        
        const content = input.value.trim();
        if (!content) return;
        
        btn.disabled = true;
        btn.textContent = 'Submitting...';
        
        submitFeedback(projectId, content)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok') {
                    input.value = '';
                    success.classList.add('show');
                    
                    // Animate text particles
                    createTextParticles(content);
                    
                    setTimeout(() => {
                        success.classList.remove('show');
                    }, 3000);
                }
            })
            .finally(() => {
                btn.disabled = false;
                btn.textContent = 'Submit Thought';
            });
    }
    
    function createTextParticles(text) {
        const words = text.split(' ').slice(0, 5); // Take first 5 words
        
        words.forEach((word, index) => {
            setTimeout(() => {
                const particle = document.createElement('div');
                particle.textContent = word;
                particle.style.cssText = `
                    position: fixed;
                    left: ${Math.random() * window.innerWidth}px;
                    top: ${Math.random() * window.innerHeight}px;
                    color: var(--accent);
                    font-size: 14px;
                    pointer-events: none;
                    z-index: 1000;
                    opacity: 1;
                    transition: all 2s ease-out;
                `;
                
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    particle.style.transform = 'translateY(-100px)';
                    particle.style.opacity = '0';
                }, 100);
                
                setTimeout(() => {
                    particle.remove();
                }, 2100);
            }, index * 200);
        });
    }
</script>
{% endblock %}
