{% extends "base.html" %}

{% block head %}
<style>
    .project-container {
        min-height: 100vh;
        padding: 80px 20px 40px;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .project-header {
        text-align: center;
        margin-bottom: 3rem;
        border-bottom: 1px solid var(--muted);
        padding-bottom: 2rem;
    }
    
    .project-title {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        animation: glitch 4s infinite;
    }
    
    .project-artist {
        font-size: 1.2rem;
        color: var(--muted);
        margin-bottom: 1rem;
    }
    
    .project-vibe {
        color: var(--accent);
        font-size: 0.9rem;
        letter-spacing: 2px;
        text-transform: uppercase;
    }
    
    .project-content {
        margin-bottom: 3rem;
    }
    
    .project-desc {
        font-size: 1.1rem;
        line-height: 1.8;
        margin-bottom: 2rem;
        font-family: 'Helvetica Neue', sans-serif;
    }
    .project-desc p {
        line-height: 1.7;
        margin-bottom: 2em;
        font-size: 1.1rem;
        color: var(--muted);
    }
    .project-desc .lead-paragraph {
        font-size: 1.4rem;
        color: var(--primary);
        font-weight: 300;
        letter-spacing: 0.5px;
    }
    .project-desc .pull-quote {
        font-size: 1.8rem;
        font-family: 'Times New Roman', serif;
        font-style: italic;
        color: var(--accent);
        text-align: center;
        margin: 3rem 0;
        padding: 1rem;
        border-top: 1px solid var(--muted);
        border-bottom: 1px solid var(--muted);
        line-height: 1.4;
    }
    .project-desc .highlight-text {
        color: var(--accent);
        font-family: 'JetBrains Mono', monospace;
        background: rgba(255, 255, 255, 0.05);
        padding: 2px 5px;
    }
    .project-desc blockquote {
        font-style: italic;
        color: var(--muted);
        margin: 2rem 0;
        padding-left: 1.5rem;
        border-left: 2px solid var(--accent);
    }
    
    .project-thumb {
        width: 100%;
        margin-bottom: 2rem;
        border: 1px solid #333;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
        padding: 12px;
        background: #0a0a0a;
    }
    
    .project-thumb img {
        width: 100%;
        display: block;
        border-radius: 4px;
        animation: fadeInImage 1s ease-in-out 0.2s forwards;
        opacity: 0;
        transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }

    @keyframes fadeInImage {
        from { opacity: 0; transform: scale(1.02); }
        to { opacity: 1; transform: scale(1); }
    }

    .project-thumb:hover img {
        transform: scale(1.03);
    }
    
    .feedback-section {
        border-top: 1px solid var(--muted);
        padding-top: 2rem;
    }
    
    .feedback-prompts {
        background: rgba(255, 255, 255, 0.05);
        border-left: 3px solid var(--accent);
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .prompt-intro {
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--primary);
    }
    
    .prompt-list {
        list-style: none;
        padding: 0;
    }
    
    .prompt-list li {
        margin-bottom: 0.5rem;
        padding-left: 1rem;
        position: relative;
        font-size: 0.9rem;
        color: var(--muted);
    }
    
    .prompt-list li::before {
        content: '→';
        position: absolute;
        left: 0;
        color: var(--accent);
    }
    
    .char-counter {
        text-align: right;
        font-size: 0.8rem;
        color: var(--muted);
        margin-top: 0.5rem;
        font-family: 'JetBrains Mono', monospace;
    }
    
    .feedback-form {
        margin-bottom: 2rem;
    }
    
    .feedback-input {
        width: 100%;
        min-height: 100px;
        padding: 15px;
        border: 1px solid var(--muted);
        background: var(--secondary);
        color: var(--primary);
        font-family: 'Inter', sans-serif;
        font-size: 1rem;
        resize: vertical;
    }
    
    .feedback-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
    }
    
    .submit-btn {
        background: none;
        border: 2px solid var(--primary);
        color: var(--primary);
        padding: 12px 24px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 1rem;
    }
    
    .submit-btn:hover {
        background: var(--accent);
        color: var(--secondary);
        border-color: var(--accent);
        transform: translate(-2px, -2px);
        box-shadow: 2px 2px 0 var(--secondary);
    }
    
    .submit-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .feedback-success {
        color: var(--accent);
        margin-top: 1rem;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .feedback-success.show {
        opacity: 1;
    }
    
    .back-link {
        display: inline-block;
        margin-top: 2rem;
        color: var(--primary);
        text-decoration: none;
        border-bottom: 1px solid var(--primary);
        transition: all 0.3s ease;
    }
    
    .back-link:hover {
        color: var(--accent);
        border-color: var(--accent);
    }

    .floating-fragments {
        position: fixed;
        font-size: 12px;
        color: var(--muted);
        opacity: 0.4;
        animation: float 12s infinite linear;
        pointer-events: none;
        z-index: -1;
    }
    
    @keyframes float {
        0% { transform: translateY(100vh) rotate(0deg); }
        100% { transform: translateY(-100px) rotate(360deg); }
    }
</style>
{% endblock %}

{% block content %}
<div class="project-container fade-in">
    <div class="project-header">
        <h1 class="project-title">{{ project.title }}</h1>
        <p class="project-artist mono">{{ project.artist }}</p>
        <p class="project-vibe mono">{{ project.vibe }}</p>
    </div>
    
    <div class="project-content">
        <div class="project-thumb">
            <img src="{{ url_for('static', filename='img/' + project.thumb) }}" alt="{{ project.title }}">
        </div>
        
        <div class="project-desc">{{ project.desc | safe }}</div>
    </div>
    
    <div class="feedback-section">
        <h3>Leave a thought</h3>
        <div class="feedback-prompts">
            <p class="prompt-intro">Your reflections become part of the collective mind. Consider:</p>
            <ul class="prompt-list">
                <li>What does this work make you feel?</li>
                <li>How does it challenge your understanding of machines?</li>
                <li>What questions does it raise about human-AI relationships?</li>
                <li>What memories or associations does it evoke?</li>
            </ul>
        </div>
        
        <form class="feedback-form" onsubmit="submitThought(event)">
            <textarea 
                class="feedback-input" 
                placeholder="Your thoughts drift here... (Your words will join the live visualization on the dashboard)"
                id="thoughtInput"
                maxlength="500"></textarea>
            <div class="char-counter">
                <span id="charCount">0</span>/500 characters
            </div>
            <button type="submit" class="submit-btn" id="submitBtn">Submit Thought</button>
            <p class="feedback-success mono" id="successMessage">Thought captured ✓ Check the Dashboard to see it live</p>
        </form>
    </div>
    
    <a href="/" class="back-link">← Return to map</a>
</div>
{% endblock %}

{% block scripts %}
<script>
    const projectId = '{{ project_id }}';
    
    // Track visit on page load
    trackVisit(projectId);
    
    // Floating fragments from project description
    createFloatingFragments();
    
    // Character counter
    document.getElementById('thoughtInput').addEventListener('input', function() {
        const count = this.value.length;
        document.getElementById('charCount').textContent = count;
        
        if (count > 450) {
            document.getElementById('charCount').style.color = 'var(--accent)';
        } else {
            document.getElementById('charCount').style.color = 'var(--muted)';
        }
    });
    
    function submitThought(event) {
        event.preventDefault();
        
        const input = document.getElementById('thoughtInput');
        const btn = document.getElementById('submitBtn');
        const success = document.getElementById('successMessage');
        
        const content = input.value.trim();
        if (!content) return;
        
        btn.disabled = true;
        btn.textContent = 'Submitting...';
        
        submitFeedback(projectId, content)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok') {
                    input.value = '';
                    document.getElementById('charCount').textContent = '0';
                    success.classList.add('show');
                    
                    // Animate text particles
                    createTextParticles(content);
                    
                    setTimeout(() => {
                        success.classList.remove('show');
                    }, 5000);
                }
            })
            .finally(() => {
                btn.disabled = false;
                btn.textContent = 'Submit Thought';
            });
    }
    
    function createTextParticles(text) {
        const words = text.split(' ').slice(0, 5); // Take first 5 words
        
        words.forEach((word, index) => {
            setTimeout(() => {
                const particle = document.createElement('div');
                particle.textContent = word;
                particle.style.cssText = `
                    position: fixed;
                    left: ${Math.random() * window.innerWidth}px;
                    top: ${Math.random() * window.innerHeight}px;
                    color: var(--accent);
                    font-size: 14px;
                    pointer-events: none;
                    z-index: 1000;
                    opacity: 1;
                    transition: all 2s ease-out;
                `;
                
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    particle.style.transform = 'translateY(-100px)';
                    particle.style.opacity = '0';
                }, 100);
                
                setTimeout(() => {
                    particle.remove();
                }, 2100);
            }, index * 200);
        });
    }
    
    function createFloatingFragments() {
        const projectText = document.querySelector('.project-desc').textContent;
        const words = projectText.split(/\s+/);
        
        // Filter for meaningful words
        const commonWords = new Set(['a', 'an', 'the', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'is', 'are', 'was', 'were', 'it', 'that', 'this', 'as', 'we', 'our', 'be', 'to', 'not', 'its', 'from', 'by', 'with', 'they', 'their', 'even', 'if', 'so', 'what', 'when', 'where', 'why', 'how', 'all', 'any', 'some', 'each', 'no', 'nor', 'too', 'very', 'can', 'will', 'just']);
        const fragments = words.map(word => word.toLowerCase().replace(/[^a-z]/g, ''))
                               .filter(word => word.length > 4 && !commonWords.has(word));
        
        const uniqueFragments = [...new Set(fragments)];

        if (uniqueFragments.length === 0) return;

        setInterval(() => {
            if (Math.random() < 0.3) {
                const fragment = document.createElement('div');
                fragment.className = 'floating-fragments';
                fragment.textContent = uniqueFragments[Math.floor(Math.random() * uniqueFragments.length)];
                fragment.style.left = Math.random() * 100 + '%';
                fragment.style.animationDuration = (10 + Math.random() * 5) + 's';
                document.body.appendChild(fragment);
                
                setTimeout(() => {
                    fragment.remove();
                }, 15000);
            }
        }, 3000);
    }
</script>
{% endblock %}
